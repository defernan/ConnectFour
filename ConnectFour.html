<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="ConnectFour.css">
    <title>Connect Four</title>
    
</head>
    
<body>
	<h1>Connect Four!</h1>
    <canvas id="board" width="700" height="600"></canvas>
    <script>
        const boardWidth=7;
        const boardHeight=6;
        const empty=0;
        const black=1;
        const red=2;
        const maxPieces=42;
        var totalPieces=0;
        var piece=0;
        var lastX;
        var lastY;
        var P1turn=true;
        var context={};
        var ctx={};
        var board= [];
        
        init();
        
        context.addEventListener("click", makeMove, false);
        
        function init(){
            context=document.getElementById("board");
            ctx=context.getContext("2d");
            for(var i=0; i < boardWidth; i++){
                board.push( [] );   
            }
            for(var i=0; i < boardWidth; i++){
                for(var j=0; j < boardHeight; j++){
                    board[i].push(empty);
                }
            }
            drawBoard();
        }
        function initializeBoard(){
            for(var i=0; i < boardWidth; i++){
                for(var j=0; j < boardHeight; j++){
                    board[i][j]=empty;
                }
            }
        }
        function makeMove(event){
            var x= 0;
			var y= 0;
			if (event.x != undefined && event.y != undefined){
				x = event.x;
				y = event.y;
			}else {// Firefox method to get the position
				x = event.clientX + document.body.scrollLeft +
				  document.documentElement.scrollLeft;
				y = event.clientY + document.body.scrollTop +
				  document.documentElement.scrollTop;
			}
            x -= context.offsetLeft;
            y -= context.offsetTop;
            x= Math.floor(x/100);
            y=context.height-y;
            y= Math.floor(y/100);
            //if piece placed, check for a winner
            if(placePiece(x)){
                var count=1;
                if(checkForWinner(lastX,lastY,count)){
                    alert("Player " + piece + "won");   
                }if(totalPieces==maxPieces){
                    alert("Tie, game over");
                }
            }
            
            //alert( x +", " + y);
            
        }
        function drawBoard(){
            var cellSize = context.height / boardHeight;
            for (var i=0; i < boardWidth; i++){
                for (var j=0; j < boardHeight; j++) {
					drawSquare(cellSize, i*cellSize, j*cellSize, cellSize, cellSize, empty);
                }
            }
        }
		
		function drawSquare(cellSize, x, y, width, height, identity) {
			ctx.rect(x, y, width, height);
			ctx.fillStyle = "yellow";
			ctx.fillRect(x, y, width, height);
			ctx.stroke();
			ctx.beginPath();
			ctx.arc(x + cellSize/2, y + cellSize/2, 40, 0, 2*Math.PI);
			if (identity == empty) {
				ctx.fillStyle = "white";
			} else if (identity == red) {
				ctx.fillStyle = "red";
			} else if (identity == black) {
				ctx.fillStyle ="black";
			}
			ctx.fill();
			ctx.stroke();
        }
		//boolean return whether place was pieced or not
        function placePiece(x){
            whosTurn();
            for(var i=0; i < boardHeight; i++){
                if(board[x][i]==empty){
                    board[x][i]=piece;
                    P1turn=!P1turn;
                    totalPieces++;
                    lastX=x;
                    lastY=i;
                    return true;
                }
                if(i==boardHeight-1){
                    alert("Column is full, select another");
                }
            }
            return false;
        }
        function whosTurn(){
            if(P1turn){
                piece=black;
            }else{
                piece=red;
            }
        }
        function checkForWinner(x,y,count){
            if(x==boardWidth || y==boardHeight){
                return false;
            }else if(board[x][y]==piece){
                if(count==4){
                    return true;
                }
                checkForWinner(x+1,y,count+1);
                checkForWinner(x,y+1,count+1);
                checkForWinner(x-1,y,count+1);
                checkForWinner(x,y-1,count+1);
                checkForWinner(x+1,y+1,count+1);
                checkForWinner(x-1,y-1,count+1);
            }else{
                return false;
            }
        }
    
    
    </script>
</body>
    
</html>